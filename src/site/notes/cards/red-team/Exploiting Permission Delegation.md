---
{"dg-publish":true,"permalink":"/cards/red-team/exploiting-permission-delegation/"}
---

~ [[Exploiting Active Directory\|Exploiting Active Directory]]
## Summary
---
**What it is:** Abusing Active Directory permission misconfigurations, specifically improper ACE delegations, to escalate privileges or assume control of higher‑tier accounts.  

**Scope:** This note covers the exploitation of AD ACL/ACE misconfigurations such as `GenericWrite`, `AddMembers`, and `ForceChangePassword`, focusing on how attackers leverage delegated permissions to move from low‑privileged to higher‑privileged groups.

**Prerequisites:**

- Valid AD credentials
- Network access to Domain Controller (LDAP/LDAPS, RPC, SMB)
- Ability to query AD objects (PowerShell AD‑RSAT, PowerSploit, or equivalent)
- The target ACEs must already exist on the AD object (misconfiguration required)

**Risks & Limitations:**

- ACE propagation delay may prevent immediate use
- Group membership or password resets trigger logs and can be monitored

**Key Topics:** 

## How it works (2–4 lines)
Active Directory stores permissions in ACLs on each object, and misconfigured ACEs (e.g., **GenericWrite**, **AddMembers**, **ForceChangePassword**) allow unintended write operations. Attackers leverage legitimate administrative mechanisms, such as group membership modification and password resets, to escalate privileges by abusing these ACEs. Tools like AD‑RSAT or PowerSploit simply perform standard AD write operations, but with misconfigured permissions, low‑privileged users can modify high‑value accounts or groups. This technique exploits **delegated access**, not vulnerabilities, meaning AD behaves exactly as designed, just with unsafe permissions.
## Steps
---
Active Directory can delegate permission and privileges through a feature called Permission Delegation (not to be confused with Kerberos Delegation). One example is delegating permission to Helpdesk team to reset user's password.
### Permission Delegation
---
Active Directory objects (users, groups, computers, OUs, etc.) each have an **Access Control List (ACL)** just like a file in Windows.

An ACL contains **Access Control Entries (ACEs)** which define:

- **Who** can do something
- **What** they are allowed to do
- **To which AD object**

**Example:**

The IT Support team (a low-privileged group) is given: **ForceChangePassword** (An example of ACE) over **Domain Users**

This sounds reasonable at first, support can reset passwords for employees.

But **Domain Users includes ALL users** by default, including:

- Domain Admins
- Enterprise Admins
- Administrators
- Service accounts
- High-value targets

So now ... IT Support can reset the password of a **Domain Admin account.**

That means they can:

1. Reset password of a domain admin
2. Log in as that domain admin
3. They instantly gain **full control of the domain**
4. Effectively a **privilege escalation** path.

In order to exploit these ACEs, you need [AD-RSAT](https://docs.microsoft.com/en-us/powershell/module/activedirectory/?view=windowsserver2022-ps) PowerShell cmdlets or [PowerSploit](https://github.com/PowerShellMafia/PowerSploit), these are the two best method to interact with AD to make these request.
#### Bloodhound
---
Refer to [[cards/red-team/Enumerating Active Directory (Authenticated Enumeration)\|Enumerating Active Directory (Authenticated Enumeration)]] for a refresher on rerunning Sharphound and viewing possible attack path.

The dataset is in zip file located in Kali Linux and also creds for u:
### Privilege Escalation
---
The most basic step to do is immediately check what our user (lauren.oconnor) is capable of by searching it in Bloodhound, as you can see you don't have alot of permissions.

For a bit of context lauren is a **member of** domain users which is set by default (double click user's node):

![Exploiting Active Directory-2.png](/img/user/cards/red-team/images/Exploiting%20Active%20Directory-2.png)

Based on our gathering that the domain is tiered, it would make sense to start first by compromising Tier 2 since (based on the structure and graph) they have administrative privileges on all workstations:

![Exploiting Active Directory-3.png|500](/img/user/cards/red-team/images/Exploiting%20Active%20Directory-3.png)

There is a slight bit of Permission Delegation in this domain:

- An administrator has misconfigured the Permission Delegation of the **IT Support** group by providing the _Domain Users_ group with the **AddMembers** ACE as **GenericWrite** contains AddMembers capabilities.
- This means any Domain Users can add accounts to the IT support group.
- Then the **IT Support** has the **ForceChangePassword** ACE for Tier 2 Admins group members, not really a misconfiguration since Tier 2 admins are not that sensitive, but it provides a dangerous attack path when combined with the initial misconfiguration.

	- Tier 0 - Domain Admins (any non server and application admins). Compromise = control over domain.
	- Tier 1 - Server and Application Administrators. File, SQL, Application servers and more.
	- Tier 2 - Workstation and help desk support.

See [genericWrite in bloodhound docs](https://bloodhound.specterops.io/resources/edges/generic-write) and refer to Microsoft’s Enterprise Access Model (EAM) for the tier 1, 2, and 3 setups.
#### AddMember
---
This will utilize **Add-ADGroupMember** Powershell cmdlet from the AD-RSAT toolset to add our AD account to the IT support group:

```C
Add-ADGroupMember "IT Support" -Members "Your.AD.Account.Username"
```

Verify with:

```C
Get-ADGroupMember -Identity "IT Support"
```

You should see your account as a member.
#### ForceChangePassword
---
Now that your account is member of the IT support group, you have inherited the ForceChangePassword Permission Delegation over the Tier 2 Admins group:

1. Identify a member of this group for our target:

```C
Get-ADGroupMember -Identity "Tier 2 Admins"
```

2. Change the password with: (t2_melanie.davies)

```C
$Password = ConvertTo-SecureString "VeryPassword@@1" -AsPlainText -Force 
Set-ADAccountPassword -Identity "<replace_with_user>" -Reset -NewPassword $Password 
```

**Note:** you may get an access error denied as the permission have not yet propagated through the domain. May take up to 10 minutes but using `gpupdate /force` and then disconnect and reconnect, which in some cases cause the synch to happen faster.

For a proof of concept since every user is part of the domain users group, try authenticating to the `THMWRK1` using the target account:

![Exploiting Active Directory-4.png](/img/user/cards/red-team/images/Exploiting%20Active%20Directory-4.png)
## Blue — Detection & Response (concise)
---

**1. Telemetry Required**

- **Windows Event Logs**

    - Security Log (Directory Service Access / Password reset)
    - Account Management events

- **Domain Controller Logs**
    
    - 4728/4729 (group membership changes)

    - 4723/4724 (password reset attempts)

- **Optional but recommended**

	- Use bloodhound hehe

**2. Tool‑agnostic Pseudo Detection Logic**

Pattern 1 — Low-privileged user adds account to elevated group

```C
IF Actor NOT IN (authorized admins/helpdesk)
AND Event = Group_Membership_Change
AND TargetGroup IN (IT Support, Tier 2 Admins, privileged groups)
THEN Alert "Suspicious AD group modification"
```

Pattern 2 — Password reset on privileged account

```C
IF Event = Password_Reset
AND TargetUser IN (Tier 2 Admins, privileged roles)
AND Actor NOT IN (authorized account operators)
THEN Alert "Unauthorized password reset"
```

