---
{"dg-publish":true,"permalink":"/cards/red-team/amsi-anti-malware-scan-interface/","tags":["blue-team","concept","red-team/concept"]}
---

~ [[cards/red-team/Runtime Detection Evasion\|Runtime Detection Evasion]]
### Introduction
---
**AMSI (Anti-Malware Scan Interface)** is a **Windows security feature** that allows antivirus tools (like Windows Defender) to **scan scripts at runtime** (e.g., PowerShell, VBScript).

- It intercepts and scans suspicious code **before** it executes.
    
- Even if code is obfuscated, AMSI can scan the **de-obfuscated form**.

**AMSI is _not_ a scanner — it's just an interface.**
## know more
---
Defender instruments AMSI to scan payloads and scripts before execution inside the .NET runtime.

AMSI wil ldetermine it's actions from a response code as a result of monitoring and scanning:

- AMSI_RESULT_CLEAN = 0
- AMSI_RESULT_NOT_DETECTED = 1 -- **not malicious but not clean either.**
- AMSI_RESULT_BLOCKED_BY_ADMIN_START = 16384 
- AMSI_RESULT_BLOCKED_BY_ADMIN_END = 20479 **content was block by policy**, not necessarily because it's malware — but because of an **admin-defined rule or restriction**.
- AMSI_RESULT_DETECTED = 32768

Sample of AMSI detects a malicious result:

```shell-session
PS C:Users\Tryhackme> 'Invoke-Hacks'
At line:1 char:1
+ "Invoke-Hacks"
+ ~~~~~~~~~~~~~~
This script contains malicious content and has been blocked by your antivirus software.
		+ CategoryInfo          : ParserError: (:) []. ParentContainsErrorRecordException
		+ FullyQualifiedErrorId : ScriptContainedMaliciousContent
```

Fully integrated into the following Windows components:

- User Account Control, or UAC
- PowerShell
- Windows Script Host (wscript and cscript)
- JavaScript and VBScript
- Office VBA macros
