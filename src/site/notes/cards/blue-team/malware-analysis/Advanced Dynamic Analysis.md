---
{"dg-publish":true,"permalink":"/cards/blue-team/malware-analysis/advanced-dynamic-analysis/","tags":["malware"]}
---

[[map-of-contents/malware\|malware]] 
### Introduction 
---
Running the program with a debugger, it is basically a broker or middleman between you and the operating system.

> [!important]+
> The ultimate goal is to find interesting instructions, put a breakpoint on it and step over it.
## GUI of x32/x64dbg
---

![[Pasted image 20240604195325.png\|Pasted image 20240604195325.png]]

1. Is the assembly instruction that the program will execute.
2. Are memory registers and will have all memory locations at any given point during the execution.
	- **EIP** will be pointing out the next instruction to be executed.
3. Is the hex output 
4. Is the [[RAM#STACK\|stack]]

Note: If we cannot find the main, we can use cutter and copy the first address and at the debugger x32dbg use `CTRL + G`.  
### Important KeyBindings
---
- `F9` to run the program
- `F8` to step over - basically step over it assuming it will run
- `F7` to step into
- `F2` to set a breakpoint
- Restart the program right under the `view` tab.
### Cross-Referencing with Cutter, Wireshark or any tools
---
The purpose of this is to know when the indicator of compromise started or happen.

- PROCMON can be used as well for Windows API call and more.

## Dropper Malware
---

![[Pasted image 20240606183131.png\|Pasted image 20240606183131.png]]

Remember that **call** is calling a function.

It made an HTTP request:

![[Pasted image 20240606190625.png\|Pasted image 20240606190625.png]]

- TODO: Try turn off inetsim

Since the API call succeded, the contents of **EAX** will be set to zero:

![[Pasted image 20240606191721.png\|250]]

Then the **ZF** is set to 1 because the result of logical operation is zero and if the result is non zero then the 
**ZF** will be set to 0, then it will be tested out by **Jump if not equal (JNE)**:

![[Pasted image 20240606192238.png\|Pasted image 20240606192238.png]]

It will not jump since the since **ZF** is set to one, it will only jump to the specified location which is **A21142** address in the same line of the **JNE** if the **Zero Flag** is set to 0.
## Tips
---
1. Try setting up breakpoints to part where, there is a delay when we are doing `F8`.
	- Right-click then follow from disassembler

## Resources
---

[[cards/blue-team/malware-analysis/Specimens/SikoMode - Malware\|SikoMode - Malware]] 

[[cards/blue-team/malware-analysis/Advanced Static Analysis\|Advanced Static Analysis]] 