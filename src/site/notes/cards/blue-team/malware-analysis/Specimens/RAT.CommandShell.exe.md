---
{"dg-publish":true,"permalink":"/cards/blue-team/malware-analysis/specimens/rat-command-shell-exe/","tags":["specimen"]}
---

[[cards/blue-team/malware-analysis/Basic Dynamic Analysis\|Basic Dynamic Analysis]]

Interesting `strings` using `floss.exe`:

```
@Content-Length
@PATCH
@PUT
@POST
@Connection: Keep-Alive
@Connection
@Host: 
@ HTTP/1.1
@User-Agent
@user-agent
@tables.nim(1103, 13) `len(t) ==
    L` the length of the table changed while iterating over it
@SSL support is not available. Cannot connect over SSL. Compile with -d:ssl to enable.
@https
@No uri scheme supplied.
InternetOpenW
InternetOpenUrlW
@wininet
@wininet
MultiByteToWideChar
@kernel32
@kernel32
MessageBoxW
@user32
@user32
@[+] what command can I run for you
@[+] online
@NO SOUP FOR YOU
@\mscordll.exe
@Nim httpclient/1.0.6
@/msdcorelib.exe
@AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
@intrt explr
@http://serv1.ec2-102-95-13-2-ubuntu.local
```

Initial Detonation:
![[Pasted image 20240522201614.png\|Pasted image 20240522201614.png]]

- A certain condition outputs the above dialog box.
- Looking at the output of the `floss.exe`, we can see "what command can I run for you" did not show up.

## Network Based Indicators (Wireshark)
---
![[Pasted image 20240522202143.png\|Pasted image 20240522202143.png]]

- Potential file download: **msdcorelib.exe**.

![[Pasted image 20240522202422.png\|Pasted image 20240522202422.png]]

- Matches the output in `floss.exe`
- Assumption: The `no soup for you` outputs if the malware did not succesfully established persistence.
- _Decoupling_ - Is a technique that downloads a resource from the Internet and rename it on the filesystem

## Host Based Indicators
---
Going to the filesystem:

![[Pasted image 20240522214852.png\|Pasted image 20240522214852.png]]

Using procmon:

![[Pasted image 20240522215520.png\|Pasted image 20240522215520.png]]

Then at the view:
![[Pasted image 20240522215619.png\|Pasted image 20240522215619.png]]

- Comparing the output `strings` with the image above the malware dynamically identifies the current user.
- In the network based indicators - in the HTTP requst - `msdcorelib.exe` but the actual downloaded was `mscordll.exe`.

![[Pasted image 20240522220211.png\|Pasted image 20240522220211.png]]

TCP Socket in listening state on port **5555**:

![[Pasted image 20240522221015.png\|Pasted image 20240522221015.png]]

Opening up a `nc <victim_ip> 5555` and checking if the connection can be established:

![[Pasted image 20240522221430.png\|Pasted image 20240522221430.png]]

It can be decoded into:
![[Pasted image 20240522221537.png\|Pasted image 20240522221537.png]]

The socket open up by the malware accepts commands and returns the output in base64 = **Remote Code Execution**.

Performing cross-corellation with `procmon` and `TCPview`:

Filter used: `Operation: TCP`
![[Pasted image 20240522222132.png\|Pasted image 20240522222132.png]]

Performing same action using `id` command without the filter:

![[Pasted image 20240522222548.png\|Pasted image 20240522222548.png]]

It is a [[Cybersecurity Terms\|bind shell]] with the capabilities of running a command.

[[cards/blue-team/malware-analysis/Specimens/RAT.ReverseShell.exe\|RAT.ReverseShell.exe]] 