---
{"dg-publish":true,"permalink":"/cards/blue-team/malware-analysis/basic-static-analysis/","tags":["malware"]}
---

[[atlas/malware\|malware]] 
### Introduction 
---
Analyzing the binary without executing it and the tools and techniques to be used are limited. Great if we have limited time
## Step 1 - File hashes
---
It is important to not "arm" the malware by changing or removing the extension as we are only performing basic static analysis.

```C
sha256sum <malware>
```

```C
md5sum <malware>
```

Then use [VirusTotal](virustotal.com) and check the hashes.
 
## Step 2 - Strings & Floss
---
_Strings_ in computer science is a collection or an array of characters, in malware analysis the malware author may put strings as part of the malicious code such as `http://malware.com` that can give the analysis an idea what the code is doing using `strings malware.exe` or `floss malware.exe`.

![Pasted image 20240518200357.png](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240518200357.png)

`floss` will represent the strings found at the bottom unlike `strings`.
- Have a domain? We can run and check it at cisco talos or VirusTotal
- Get the IP address of the domain and run it on the same tools.

## Step 3 - Analyzing the Import Address Table
---
All Windows executable binaries have a magic byte that starts with `MZ`, we can view this using `PEview`.

Here are the interesting headers to view at:

1. The **timestamp** under `IMAGE_NT_HEADERS` click `IMAGE_FILE_HEADER` - this can tell when the file was compiled.

2. Compare the value of `Virtual Size` - this is the amount of data on disk (memory) when the binary is run and `Size of Raw Data` the actual size of the binary
![Pasted image 20240518214128.png](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240518214128.png)

Calculate the value using a `hexadecimal` calculator, if the **Size of Raw Data** is much smaller than the **Virtual Size** this could possibly mean that we are dealing with a packed binary.

3. The `IMPORT Address Table` under the **SECTION .rdata** - it list all external functions that the program uses such as DLLs or Windows API
	- [https://malapi.io/](https://malapi.io/) - a place to check for commonly used Windows API in malware.

## Step 4 - Packed Binary
---
Is a compressed binary with the purpose of hiding/crushing it's original content and then at runtime unhide or restore the original content.

![Pasted image 20240522120859.png](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240522120859.png)

**UPXn** is the packer program and the **IMPORT Address Table** contains a small amount of API calls and libraries which indicates a packed binary.

- **LoadLibraryA** and **GetProcAddress** are imports that use to identify other imports at runtime.
- At **PEstudio** - we can check for **sections** tab.

### PEstudio 
---
It does what we did above
### CAPA 
---
Is a command line based tool that performs static analysis using pre-made rules or custom rules by others [here](https://github.com/mandiant/capa-rules).

```
capa malware.exe
```

![Pasted image 20240522124032.png](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240522124032.png)

The **MBC or Malware Behavioral Catalog** is similar to ATT&CK but it is more focused on malware  - [here](https://github.com/MBCProject/mbc-markdown#malware-objective-descriptions).

Adding `-vv` verbose flag:

![Pasted image 20240522124456.png](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240522124456.png)

- **function @ ....** Shows the location in the binary that the rule triggered 
### Advices
---
In **step 2**, it is important to note that some of the strings are meant to be a distraction

Automation of the basic triage with `blue-jupyter`:

- Clone the PMAT-lab branch of the code repository and change directories into it:

```bash
git clone --branch PMAT-lab https://github.com/HuskyHacks/blue-jupyter.git && cd blue-jupyter
```

- Run the following Docker build command:

```bash
sudo docker build -t bluejupyter .
```

- When the image is finished building, run the following command to launch the notebook with a published port of 8888 and a mounted volume to the dropbox directory:

```bash
sudo docker run -it -p 8888:8888 -v /home/remnux/blue-jupyter:/src bluejupyter
```

- Now, if you want to add malware to the dropbox, copy it from the PMAT-labs repository into the /home/remnux/blue-jupyter/malware-analysis/dropbox/ directory and it will also copy into the container.




## Resource
---
[[cards/blue-team/malware-analysis/Basic Dynamic Analysis\|Basic Dynamic Analysis]]

[[cards/blue-team/malware-analysis/Advanced Static Analysis\|Advanced Static Analysis]]
