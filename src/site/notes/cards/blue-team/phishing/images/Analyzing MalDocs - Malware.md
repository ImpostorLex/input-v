---
{"dg-publish":true,"permalink":"/cards/blue-team/phishing/images/analyzing-mal-docs-malware/","tags":["specimen","malware"]}
---

~ [[atlas/malware\|malware]]
### Introduction 
---
It should be no surprise that the biggest vendor of Operating System Microsoft is the most targeted product by hackers, this includes their own productivity software such as Excel or any software that has _Macro_ on it.

Macro is used to automate repetitive task by 'recording' what you want to do.

## XLSM
---
When an excel file has an extension of `.xlsm`, it is a macro enabled sheet, one thing to note is that excel files are similar to a directory or a zip file, basically a file that contains a lot of files - this includes the actual data, styles, and more:

![Pasted image 20240614201719.png|450](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240614201719.png)

A `.bin` is the extension for visual basic scripting, one of the features of office documents is you can put any office documents inside other types of documents this is made possible of the OLE technology.

![Pasted image 20240614202231.png|450](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240614202231.png)

Using the command `oledump.py` displays the _data streams_ refers to the continuous flow of data that can be imported and updated in real-time, the **capital M** is a symbol that a macro was found to view:

```bash
oledump.py -s 3 filename -S
```

The `-s 3` tells to dump the bytes of **VBA/Module 1** and the `-S` to get and output all strings only:

![Pasted image 20240614202918.png](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240614202918.png)
Now to get the embedded macro, we simply remove the `-S` flag and replace with `--vbadecompresscorrupt`:

![Pasted image 20240614203110.png](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240614203110.png)
## WORD - Remote Template
---
A `.docm` denotes a Word document that has macro embedded - we can perform the same as the `.xlsm` however `.docx` is not safe either.

- Turn `.docx` into a `.zip` then navigate to `word/_rels` directory

A filename **settings.xml.rels** will contain the location of templates - when we select a template - it actually is downloaded or if not it is already in the host - the idea is the same for malicious purposes, the attacker sets a `Target=domain.com` and downloads a macro:

![Pasted image 20240614205548.png](/img/user/cards/blue-team/malware-analysis/images/Pasted%20image%2020240614205548.png)

So once the document is run the template will be pulled down and executes as if the script is part of the file.
### Questions and Problems
---
## Conclusion
---

